# Cat Service Infrastructure Deployment Guide

## Overview

This infrastructure deploys the Cat Service Flask application as an AWS Lambda function with a dedicated Function URL in the ca-central-1 region.

## Architecture

```
┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐
│   Function URL  │───▶│  Lambda Function │───▶│  CloudWatch     │
│   (Public)      │    │  (Python 3.9)   │    │  Logs & Metrics │
└─────────────────┘    └──────────────────┘    └─────────────────┘
```

## Prerequisites

- Pulumi CLI installed (`pulumi version` should work)
- AWS CLI configured with ca-central-1 access
- Node.js and npm installed

## Quick Start

1. **Install dependencies:**
   ```bash
   cd infrastructure
   npm install
   ```

2. **Initialize Pulumi stack:**
   ```bash
   pulumi stack init dev
   ```

3. **Configure the deployment:**
   ```bash
   pulumi config set aws:region ca-central-1
   pulumi config set appName cat-service
   pulumi config set environment dev
   ```

4. **Preview the deployment:**
   ```bash
   pulumi preview
   ```

5. **Deploy the infrastructure:**
   ```bash
   pulumi up
   ```

## Configuration Options

| Parameter | Description | Default | Required |
|-----------|-------------|---------|----------|
| `aws:region` | AWS region for deployment | `ca-central-1` | Yes |
| `appName` | Application name for resource naming | `cat-service` | No |
| `environment` | Environment (dev/prod) | `dev` | No |

## Resources Created

- **Lambda Function**: Runs the Flask cat service application
- **Function URL**: Public HTTPS endpoint for direct access
- **IAM Role**: Execution role with basic Lambda permissions
- **CloudWatch Log Group**: Centralized logging with retention policy
- **CloudWatch Dashboard**: Monitoring metrics and performance

## Security Features

- ✅ IAM roles with least-privilege access
- ✅ CloudWatch logging enabled
- ✅ Resource tagging for cost allocation
- ✅ CORS configuration for web access
- ✅ No hardcoded secrets or credentials

## Cost Considerations

**Development Environment:**
- Lambda: Pay-per-request (very low cost for demo usage)
- CloudWatch: Minimal logging costs
- Function URL: No additional charges

**Estimated Monthly Cost:** < $1 USD for light demo usage

## Monitoring

After deployment, access your monitoring dashboard:
- CloudWatch Dashboard: Available in stack outputs
- Lambda Metrics: Invocations, errors, duration
- Log Retention: 7 days (dev) / 30 days (prod)

## Testing the Deployment

After successful deployment, test your function:

```bash
# Get the function URL from stack outputs
pulumi stack output functionUrl

# Test the endpoint
curl $(pulumi stack output functionUrl)
```

You should see the cat service HTML page with a random cat image!

## Troubleshooting

### Common Issues

1. **AWS Authentication**: Ensure `aws sts get-caller-identity` works
2. **Region Access**: Verify ca-central-1 is available in your account
3. **Permissions**: Check IAM permissions for Lambda and CloudWatch

### Logs

View function logs:
```bash
aws logs tail $(pulumi stack output logGroupName) --follow
```

## Cleanup

To remove all resources:
```bash
pulumi destroy
```

## Next Steps

- Set up CI/CD pipeline for automated deployments
- Add custom domain name for the Function URL
- Implement monitoring alerts for errors
- Add environment-specific configurations

---

**Generated by**: Pulumi Official Deployment Assistant
**Region**: ca-central-1
**Runtime**: Python 3.9 on AWS Lambda
